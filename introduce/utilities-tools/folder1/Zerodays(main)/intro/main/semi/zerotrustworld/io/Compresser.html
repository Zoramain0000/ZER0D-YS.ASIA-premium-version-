<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üì¶  Image Compressor</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
background-image: url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSFVOZ2CsKQIPT0Lk06f5bNALaBIuEhMWppBg&s');
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: red;
    }
    .container {
      max-width: 800px;
      margin: auto;
background: rgba(0,0,0,0.5);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 12px rgba(0,0,0,0.1);
    }
    .drop-area {
      border: 2px dashed red;
      padding: 30px;
      text-align: center;
      border-radius: 10px;
      margin-bottom: 20px;
background: rgba(0,0,0,0.5);
      cursor: pointer;
      color: red;
    }
    .drop-area:hover {
background: rgba(0,0,0,0.5);
    }
    .controls {
      display: grid;
      gap: 10px;
      margin-bottom: 20px;
    }
    .controls input, .controls select {
      width: 100%;
      padding: 8px;
      border-radius: 6px;
      border: 1px solid red;
    }
    button {
      padding: 12px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      background: red;
      color: green;
      cursor: pointer;
    }
    button:hover {
background: rgba(0,0,0,0.5);
    }
    .preview-container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }
    .image-card {
      width: 180px;
      border: 1px solid red;
      border-radius: 8px;
      padding: 10px;
background: rgba(0,0,0,0.5);
    }
    .image-card img {
      max-width: 100%;
      border-radius: 5px;
    }
    .info {
      font-size: 13px;
      margin-top: 5px;
    }
    input, label {
background: rgba(0,0,0,0.5);
color: red;
    }
  </style>
</head>
<body>
  <h1>üì¶ Advanced Image Compressor</h1>
  <div class="container">
    <div class="drop-area" id="drop-area">üìÅ Drop multiple images or click to upload</div>
    <input type="file" id="fileInput" accept="image/*" multiple hidden>

    <div class="controls">
      <label>Compression Quality (1‚Äì100)</label>
      <input type="range" id="quality" min="1" max="100" value="70">

      <label>Output Format</label>
      <select id="format">
        <option value="image/jpeg">JPEG</option>
        <option value="image/webp">WebP</option>
      </select>

      <label>Resize Width (optional)</label>
      <input type="number" id="resizeWidth" placeholder="e.g., 800 (leave blank to skip)">

      <label>Resize Height (optional)</label>
      <input type="number" id="resizeHeight" placeholder="e.g., 600 (leave blank to auto scale)">
      
      <button id="compressBtn">üîΩ Compress All & Download</button>
    </div>

    <div class="preview-container" id="previewContainer"></div>
    <canvas id="canvas" style="display:none;"></canvas>
  </div>

  <script>
    const dropArea = document.getElementById("drop-area");
    const fileInput = document.getElementById("fileInput");
    const compressBtn = document.getElementById("compressBtn");
    const qualityInput = document.getElementById("quality");
    const formatInput = document.getElementById("format");
    const resizeWidthInput = document.getElementById("resizeWidth");
    const resizeHeightInput = document.getElementById("resizeHeight");
    const previewContainer = document.getElementById("previewContainer");
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    let imageFiles = [];

    dropArea.addEventListener("click", () => fileInput.click());
    dropArea.addEventListener("dragover", e => {
      e.preventDefault();
      dropArea.style.backgroundColor = "#e0f7fa";
    });
    dropArea.addEventListener("dragleave", () => {
      dropArea.style.backgroundColor = "";
    });
    dropArea.addEventListener("drop", e => {
      e.preventDefault();
      dropArea.style.backgroundColor = "";
      handleFiles(e.dataTransfer.files);
    });
    fileInput.addEventListener("change", () => handleFiles(fileInput.files));

    function handleFiles(files) {
      imageFiles = Array.from(files).filter(file => file.type.startsWith("image/"));
      previewContainer.innerHTML = "";
      imageFiles.forEach(file => {
        const reader = new FileReader();
        reader.onload = e => {
          const img = new Image();
          img.onload = () => {
            const card = document.createElement("div");
            card.className = "image-card";
            const originalKB = (file.size / 1024).toFixed(1);
            card.innerHTML = `
              <img src="${e.target.result}">
              <div class="info">Original: ${originalKB} KB<br>Dimensions: ${img.width}√ó${img.height}</div>
            `;
            previewContainer.appendChild(card);
          };
          img.src = e.target.result;
        };
        reader.readAsDataURL(file);
      });
    }

    compressBtn.addEventListener("click", async () => {
      if (imageFiles.length === 0) return alert("No images selected.");

      const quality = parseInt(qualityInput.value) / 100;
      const format = formatInput.value;
      const resizedWidth = parseInt(resizeWidthInput.value) || null;
      const resizedHeight = parseInt(resizeHeightInput.value) || null;

      for (const file of imageFiles) {
        const reader = new FileReader();
        await new Promise(resolve => {
          reader.onload = () => {
            const img = new Image();
            img.onload = () => {
              let w = img.width;
              let h = img.height;
              if (resizedWidth && resizedHeight) {
                w = resizedWidth;
                h = resizedHeight;
              } else if (resizedWidth) {
                h = Math.round((img.height / img.width) * resizedWidth);
                w = resizedWidth;
              }

              canvas.width = w;
              canvas.height = h;
              ctx.clearRect(0, 0, w, h);
              ctx.drawImage(img, 0, 0, w, h);

              canvas.toBlob(blob => {
                const link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                const ext = format === "image/jpeg" ? "jpg" : "webp";
                link.download = `compressed_${Date.now()}.${ext}`;
                link.click();

                const compressedKB = (blob.size / 1024).toFixed(1);
                const card = document.createElement("div");
                card.className = "image-card";
                card.innerHTML = `<div class="info">Compressed: ${compressedKB} KB<br>Saved ‚úîÔ∏è</div>`;
                previewContainer.appendChild(card);
                resolve();
              }, format, quality);
            };
            img.src = reader.result;
          };
          reader.readAsDataURL(file);
        });
      }
    });
  </script>
</body>
</html>
