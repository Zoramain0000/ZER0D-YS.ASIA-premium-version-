<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ğŸŒ Public CCTV Log Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      background: #0f172a;
      color: #e2e8f0;
      font-family: monospace;
      padding: 20px;
    }
    h1, h3 {
      color: #38bdf8;
    }
    input, button {
      padding: 8px;
      margin: 4px 0;
      max-width: 300px;
      width: 100%;
      border: none;
      background: #1e293b;
      color: #e2e8f0;
    }
    button {
      cursor: pointer;
      background: #2563eb;
    }
    button:hover {
      background: #1e40af;
    }
    .log {
      margin-top: 20px;
      padding: 10px;
      background: #1e293b;
      border: 1px dashed #38bdf8;
      height: 300px;
      overflow-y: auto;
      white-space: pre-wrap;
    }
    .cam {
      margin-top: 10px;
    }
  </style>
</head>
<body>

  <h1>ğŸŒ Public CCTV Log Generator</h1>

  <input id="country" placeholder="Country code (e.g. US, CA, PH)" />
  <button onclick="searchByCountry()">ğŸ” Search by Country</button>
  <button onclick="searchByBBox()">ğŸ—ºï¸ Search by Map Area</button>
  <button onclick="clearLog()">ğŸ§¹ Clear Log</button>
  <button onclick="downloadLog()">ğŸ’¾ Download Log</button>

  <h3>ğŸ“„ Logs</h3>
  <div class="log" id="log"></div>

  <script>
    const WINDY_KEY = "btHcmmRlXllSC8eZ9zQ82pleThlC83W4"; // public key
    const logBox = document.getElementById("log");

    function log(msg) {
      logBox.textContent += msg + "\n";
      logBox.scrollTop = logBox.scrollHeight;
    }

    function clearLog() {
      logBox.textContent = "";
    }

    function downloadLog() {
      const blob = new Blob([logBox.textContent], { type: 'text/plain' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = "cctv_logs.txt";
      a.click();
    }

    async function fetchCams(url) {
      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error(res.statusText);
        const data = await res.json();
        return data.result.webcams;
      } catch (e) {
        alert("âŒ Error fetching: " + e.message);
        return [];
      }
    }

    async function searchByCountry() {
      clearLog();
      const country = document.getElementById("country").value.trim().toUpperCase();
      if (!country.match(/^[A-Z]{2}$/)) {
        return alert("Please provide a valid 2-letter country code.");
      }
      const url = `https://api.windy.com/api/webcams/v3/list/country=${country}?show=webcams:location,player`;
      const cams = await fetchCams(url);
      log(`ğŸ¯ Found ${cams.length} cams in ${country}`);
      cams.forEach(c => {
        const name = c.title;
        const ip = c.location.city || "N/A";
        const stream = c.player.day || c.player.live || "No stream";
        log(`[${c.location.country}] ${name} @ ${stream}`);
      });
    }

    async function searchByBBox() {
      clearLog();
      const bbox = prompt("Enter bbox (lon1,lat1,lon2,lat2):", "-180,-90,180,90");
      if (!bbox) return;
      const url = `https://api.windy.com/api/webcams/v3/list/bbox=${bbox}?show=webcams:location,player`;
      const cams = await fetchCams(url);
      log(`ğŸ¯ Found ${cams.length} cams in map area`);
      cams.forEach(c => {
        const name = c.title;
        const cc = c.location.country;
        const stream = c.player.day || c.player.live || "No stream";
        log(`[${cc}] ${name} -> ${stream}`);
      });
    }

  </script>
</body>
</html>
