<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Zero Days Gallery</title>
  <link rel="stylesheet" href="dcr.css">
  <style>
    * { box-sizing: border-box; }
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: sans-serif;
      background-image: url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSFVOZ2CsKQIPT0Lk06f5bNALaBIuEhMWppBg&s');
      color: #fff;
    }
    .container {
      display: flex;
      flex-direction: column;
      height: 100vh;
      background: rgba(0,0,0,0.6);
    }
    .sidebar {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      background: rgba(0,0,0,0.8);
      padding: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.4);
    }
    .sidebar h2 {
      color: red;
      margin: 0 20px 0 0;
      font-size: 1.5em;
    }
    .sidebar nav {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .sidebar button {
      background: transparent;
      border: 1px solid red;
      color: red;
      padding: 6px 12px;
      border-radius: 4px;
      cursor: pointer;
    }
    .sidebar button:hover, .sidebar button.active {
      background: red;
      color: black;
    }
    .main-content {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
    }
    .gallery-title {
      font-size: 1.8em;
      color: red;
      margin-bottom: 20px;
    }
    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    .gallery-item {
      position: relative;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0,0,0,0.6);
      background: black;
    }
    .gallery-item img, .gallery-item video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      cursor: pointer;
    }
    .gallery-item input[type="checkbox"] {
      position: absolute;
      top: 8px;
      left: 8px;
      transform: scale(1.2);
    }
    .gallery-item button {
      position: absolute;
      bottom: 6px;
      right: 6px;
      background: red;
      border: none;
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
    }
    .modal {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.8);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }
    .modal.active { display: flex; }
    .modal-content {
      max-width: 90vw;
      max-height: 90vh;
      position: relative;
    }
    .modal-content img, .modal-content video {
      max-width: 100%;
      max-height: 100%;
      display: block;
    }
    .modal-close {
      position: absolute;
      top: 8px;
      right: 8px;
      background: rgba(0,0,0,0.6);
      border: none;
      color: red;
      font-size: 1.5em;
      cursor: pointer;
    }
    .download-button {
      margin-top: 20px;
      padding: 10px 20px;
      background-color: red;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .download-button:hover {
      background-color: darkred;
    }
    .drop-area {
      border: 2px dashed red;
      padding: 20px;
      text-align: center;
      margin-top: 20px;
      color: red;
    }
    .drop-area.hover {
      background: rgba(255, 0, 0, 0.1);
    }
    @media (max-width: 600px) {
      .gallery {
        grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      }
    }
  </style>
</head>
<body>
<div class="container">
  <aside class="sidebar">
    <h2>Zero Days</h2>
    <nav>
      <button class="active" id="allBtn">All</button>
      <button id="videoBtn">Video</button>
      <button id="imageBtn">Image</button>
      <button id="uploadBtn">Upload Image</button>
      <button id="uploadVideoBtn">Upload Video</button>
      <button id="addUrlImageBtn">Add URL</button>
      <button id="refreshBtn">Refresh</button>
      <button id="deleteBtn">Delete</button>
      <button id="undoBtn">Undo</button>
      <button id="redoBtn">Redo</button>
      <button id="selectAllBtn">Select All</button>
      <button id="unselectAllBtn">Unselect All</button>
      <button id="exportPdfBtn" style="display:none;">Export to PDF</button>
    </nav>
  </aside>
  <main class="main-content">
    <h1 class="gallery-title">Image and Video Gallery</h1>
    <div class="gallery" id="gallery"></div>
    <button class="download-button" id="downloadBtn" style="display:none;">Download Selected</button>
    <div class="drop-area" id="dropArea">Drag & Drop files here to upload</div>
  </main>
</div>

<div class="modal" id="modal">
  <div class="modal-content">
    <button class="modal-close" id="modalClose">&times;</button>
    <img src="" id="modalImage" style="display:none;" />
    <video controls id="modalVideo" style="display:none;"></video>
  </div>
</div>

<input type="file" id="fileInput" accept="image/*" multiple style="display:none;" />
<input type="file" id="videoInput" accept="video/*" multiple style="display:none;" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script>
  const gallery = document.getElementById('gallery');
  const fileInput = document.getElementById('fileInput');
  const videoInput = document.getElementById('videoInput');
  const downloadBtn = document.getElementById('downloadBtn');
  const exportPdfBtn = document.getElementById('exportPdfBtn');
  const modal = document.getElementById('modal');
  const modalImage = document.getElementById('modalImage');
  const modalVideo = document.getElementById('modalVideo');
  const modalClose = document.getElementById('modalClose');
  const dropArea = document.getElementById('dropArea');

  let mediaItems = JSON.parse(localStorage.getItem('mediaItems')) || [];
  let lastDeletedItem = null;
  let lastRedoItem = null;

  function displayGallery(items = mediaItems) {
    gallery.innerHTML = '';
    items.forEach((item, index) => {
      const div = document.createElement('div');
      div.className = 'gallery-item';

      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.dataset.index = index;
      checkbox.addEventListener('change', toggleDownloadButtonVisibility);
      div.appendChild(checkbox);

      if (item.type.startsWith('image')) {
        const img = document.createElement('img');
        img.src = item.url;
        img.onclick = () => openModal(item.url, 'image');
        div.appendChild(img);
      } else if (item.type.startsWith('video')) {
        const video = document.createElement('video');
        video.src = item.url;
        video.controls = true;
        video.onclick = () => openModal(item.url, 'video');
        div.appendChild(video);
      }

      const delBtn = document.createElement('button');
      delBtn.textContent = 'Delete';
      delBtn.onclick = () => deleteMedia(index);
      div.appendChild(delBtn);

      gallery.appendChild(div);
    });
    toggleDownloadButtonVisibility();
  }

  function toggleDownloadButtonVisibility() {
    const checked = document.querySelectorAll('.gallery input[type="checkbox"]:checked');
    downloadBtn.style.display = checked.length > 0 ? 'inline-block' : 'none';
    exportPdfBtn.style.display = checked.length > 0 ? 'inline-block' : 'none';
  }

  function deleteMedia(index) {
    lastDeletedItem = mediaItems[index];
    mediaItems.splice(index, 1);
    localStorage.setItem('mediaItems', JSON.stringify(mediaItems));
    displayGallery();
  }

  function undoDelete() {
    if (lastDeletedItem) {
      mediaItems.push(lastDeletedItem);
      lastDeletedItem = null;
      localStorage.setItem('mediaItems', JSON.stringify(mediaItems));
      displayGallery();
    }
  }

  function redoDelete() {
    if (lastRedoItem) {
      mediaItems.push(lastRedoItem);
      lastRedoItem = null;
      localStorage.setItem('mediaItems', JSON.stringify(mediaItems));
      displayGallery();
    }
  }

  function openModal(url, type) {
    modal.classList.add('active');
    modalImage.style.display = type === 'image' ? 'block' : 'none';
    modalVideo.style.display = type === 'video' ? 'block' : 'none';
    modalImage.src = type === 'image' ? url : '';
    modalVideo.src = type === 'video' ? url : '';
  }

  modalClose.onclick = () => {
    modal.classList.remove('active');
    modalImage.src = '';
    modalVideo.src = '';
  };

  document.querySelectorAll('.sidebar button').forEach(btn => {
    btn.addEventListener('click', () => {
      document.querySelectorAll('.sidebar button').forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      switch (btn.id) {
        case 'uploadBtn': fileInput.click(); break;
        case 'uploadVideoBtn': videoInput.click(); break;
        case 'addUrlImageBtn':
          const mediaUrl = prompt('Enter media URL:');
          if (mediaUrl) {
            const type = prompt('Is it an "image" or "video"?').toLowerCase();
            if (type === 'image' || type === 'video') {
              const test = document.createElement(type === 'image' ? 'img' : 'video');
              test.onload = () => {
                mediaItems.push({ url: mediaUrl, type: `${type}/url` });
                localStorage.setItem('mediaItems', JSON.stringify(mediaItems));
                displayGallery();
              };
              test.onerror = () => alert('Failed to load the media URL.');
              test.src = mediaUrl;
            } else {
              alert('Invalid type. Must be "image" or "video".');
            }
          }
          break;
        case 'refreshBtn': displayGallery(); break;
        case 'deleteBtn':
          [...document.querySelectorAll('.gallery input[type="checkbox"]:checked')]
            .map(cb => parseInt(cb.dataset.index))
            .sort((a, b) => b - a)
            .forEach(deleteMedia);
          break;
        case 'undoBtn': undoDelete(); break;
        case 'redoBtn': redoDelete(); break;
        case 'videoBtn': displayGallery(mediaItems.filter(i => i.type.startsWith('video'))); break;
        case 'imageBtn': displayGallery(mediaItems.filter(i => i.type.startsWith('image'))); break;
        case 'selectAllBtn':
          document.querySelectorAll('.gallery input[type="checkbox"]').forEach(cb => cb.checked = true);
          toggleDownloadButtonVisibility(); break;
        case 'unselectAllBtn':
          document.querySelectorAll('.gallery input[type="checkbox"]').forEach(cb => cb.checked = false);
          toggleDownloadButtonVisibility(); break;
        default: displayGallery();
      }
    });
  });

  fileInput.onchange = videoInput.onchange = (e) => {
    [...e.target.files].forEach(file => {
      const url = URL.createObjectURL(file);
      mediaItems.push({ url, type: file.type });
    });
    localStorage.setItem('mediaItems', JSON.stringify(mediaItems));
    displayGallery();
  };

  dropArea.ondragover = (e) => {
    e.preventDefault();
    dropArea.classList.add('hover');
  };

  dropArea.ondragleave = () => {
    dropArea.classList.remove('hover');
  };

  dropArea.ondrop = (e) => {
    e.preventDefault();
    dropArea.classList.remove('hover');
    [...e.dataTransfer.files].forEach(file => {
      const url = URL.createObjectURL(file);
      mediaItems.push({ url, type: file.type });
    });
    localStorage.setItem('mediaItems', JSON.stringify(mediaItems));
    displayGallery();
  };

  downloadBtn.onclick = () => {
    const zip = new JSZip();
    const selected = document.querySelectorAll('.gallery input[type="checkbox"]:checked');
    let count = 0;
    selected.forEach(cb => {
      const item = mediaItems[parseInt(cb.dataset.index)];
      const nameFromUrl = item.url.split('/').pop().split('?')[0];
      const extension = item.type.includes('video') ? 'mp4' : 'png';
      const fileName = nameFromUrl || `file${count + 1}.${extension}`;

      fetch(item.url)
        .then(response => {
          if (!response.ok) throw new Error('Failed to fetch file');
          return response.blob();
        })
        .then(blob => {
          zip.file(fileName, blob);
          count++;
          if (count === selected.length) {
            zip.generateAsync({ type: 'blob' }).then(content => saveAs(content, 'media.zip'));
          }
        })
        .catch(error => alert('Error: ' + error.message));
    });
  };

  // ‚úÖ New Feature: Show warning popup
  window.addEventListener('load', () => {
    setTimeout(() => {
      alert(`‚ö†Ô∏è Zero Days Tool Notice:\n\nThis tool allows you to compress images and videos into a .zip file.\n\nüìå You cannot save media individually here.\n‚úÖ Only ZIP download is supported.\n\nTry compressing if you like!`);
    }, 400);
  });

  displayGallery();
</script>
</body>
</html>
