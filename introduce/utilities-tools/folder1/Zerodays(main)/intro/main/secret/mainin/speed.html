<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>‚å®Ô∏è Typing Speed Analyzer + Leaderboard + Graph</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
    background-image: url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSFVOZ2CsKQIPT0Lk06f5bNALaBIuEhMWppBg&s');
      color: #ff0000;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
    }
    h1 { color: #ff0000; }
    input, textarea {
      font-family: inherit;
    }
    #quoteDisplay {
      border: 2px dashed #ff0000;
      padding: 1rem;
      margin-bottom: 1rem;
      border-radius: 8px;
      min-height: 80px;
      width: 100%;
      max-width: 800px;
      font-size: 1.2rem;
    }
    #quoteInput {
      width: 100%;
      max-width: 800px;
      padding: 1rem;
      font-size: 1.2rem;
      border-radius: 8px;
      border: 2px solid #ff0000;
      outline: none;
      margin-bottom: 1rem;
    }
    #quoteInput.correct { border-color: #22c55e; }
    #quoteInput.incorrect { border-color: #ef4444; }
    .stats {
      display: flex;
      gap: 2rem;
      margin-bottom: 1rem;
    }
    .stat {
      font-size: 1.2rem;
      background: #0000007e;
      padding: 0.75rem 1rem;
      border-radius: 6px;
    }
    button {
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      background: #f83838;
      color: #0f2a10;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin-top: 0.5rem;
    }
    button:hover { background: #00000075; }
    .footer {
      margin-top: 2rem;
      font-size: 0.9rem;
      color: #ff0000;
    }
    #customQuoteInput, #usernameInput {
      margin: 1rem 0;
      max-width: 800px;
      width: 100%;
      padding: 0.75rem;
      font-size: 1rem;
      border-radius: 6px;
      border: 1px solid #000000;
      background: #0000009f;
      color: #ff0000;
    }
    .leaderboard {
      margin-top: 2rem;
      width: 100%;
      max-width: 400px;
    }
    .leaderboard h3 {
      margin: 0;
      margin-bottom: 0.5rem;
      color: #ff004c;
      text-align: center;
    }
    .leaderboard ul {
      list-style: none;
      padding: 0;
    }
    .leaderboard li {
      background: #00000081;
      margin: 0.25rem 0;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      display: flex;
      justify-content: space-between;
    }
    .graph {
      margin-top: 2rem;
      max-width: 600px;
      width: 100%;
    }
    .bar {
      fill: #ff0000;
      transition: 0.3s;
    }
    .bar:hover {
      fill: #00000056;
    }
  </style>
</head>
<body>
  <h1>‚å®Ô∏è Typing Speed Analyzer</h1>

  <input id="usernameInput" type="text" placeholder="üë§ Enter your name before starting..." />

  <textarea id="customQuoteInput" rows="2" placeholder="‚úçÔ∏è Add your own quote and click 'Use This Quote'..."></textarea>
  <button onclick="useCustomQuote()">üì• Use This Quote</button>

  <div id="quoteDisplay"></div>
  <input type="text" id="quoteInput" placeholder="Start typing here..." disabled />

  <div class="stats">
    <div class="stat">‚è± Time: <span id="timer">0</span>s</div>
    <div class="stat">‚ö° WPM: <span id="wpm">0</span></div>
    <div class="stat">üéØ Accuracy: <span id="accuracy">100</span>%</div>
  </div>

  <button onclick="startGame()">üîÅ Start New Test</button>

  <div class="leaderboard">
    <h3>üèÜ Leaderboard (Top 5 WPM)</h3>
    <ul id="leaderboardList"></ul>
  </div>

  <div class="graph">
    <h3 style="text-align:center;">üìä Progress (Last 10 WPM Tests)</h3>
    <svg id="wpmChart" width="100%" height="150"></svg>
  </div>

  <div class="footer">Made with üíª JavaScript only ‚Äî No backend used</div>

  <script>
    const quoteDisplay = document.getElementById('quoteDisplay');
    const quoteInput = document.getElementById('quoteInput');
    const timerDisplay = document.getElementById('timer');
    const wpmDisplay = document.getElementById('wpm');
    const accuracyDisplay = document.getElementById('accuracy');
    const leaderboardList = document.getElementById('leaderboardList');
    const customQuoteInput = document.getElementById('customQuoteInput');
    const usernameInput = document.getElementById('usernameInput');
    const wpmChart = document.getElementById('wpmChart');

    let quotes = [
      "The quick brown fox jumps over the lazy dog.",
      "Typing is a fundamental skill for productivity.",
      "JavaScript runs in your browser without a backend.",
      "Practice makes perfect, even for coders.",
      "Stay focused and never give up."
    ];

    let currentQuote = '';
    let startTime, interval;

    function useCustomQuote() {
      const newQuote = customQuoteInput.value.trim();
      if (newQuote.length > 10) {
        currentQuote = newQuote;
        startQuote(currentQuote);
      } else {
        alert("Please enter a longer quote (min 10 characters).");
      }
    }

    function startGame() {
      if (!usernameInput.value.trim()) {
        alert("Please enter your name before starting!");
        return;
      }
      currentQuote = quotes[Math.floor(Math.random() * quotes.length)];
      startQuote(currentQuote);
    }

    function startQuote(quote) {
      quoteDisplay.innerHTML = quote.split('').map(char => `<span>${char}</span>`).join('');
      quoteInput.value = '';
      quoteInput.className = '';
      quoteInput.disabled = false;
      quoteInput.focus();
      timerDisplay.textContent = 0;
      wpmDisplay.textContent = 0;
      accuracyDisplay.textContent = 100;
      startTime = null;
      if (interval) clearInterval(interval);
      interval = setInterval(updateTimer, 1000);
    }

    function updateTimer() {
      if (!startTime) return;
      const elapsed = Math.floor((Date.now() - startTime) / 1000);
      timerDisplay.textContent = elapsed;
      const words = quoteInput.value.trim().split(/\s+/).length;
      const wpm = elapsed > 0 ? Math.round((words / elapsed) * 60) : 0;
      wpmDisplay.textContent = wpm;
    }

    quoteInput.addEventListener('input', () => {
      const arrayQuote = quoteDisplay.querySelectorAll('span');
      const arrayValue = quoteInput.value.split('');
      if (!startTime) startTime = Date.now();
      let correct = true, typedCorrect = 0;

      arrayQuote.forEach((charSpan, index) => {
        const char = arrayValue[index];
        if (char == null) {
          charSpan.classList.remove('correct', 'incorrect');
          correct = false;
        } else if (char === charSpan.textContent) {
          charSpan.classList.add('correct');
          charSpan.classList.remove('incorrect');
          typedCorrect++;
        } else {
          charSpan.classList.add('incorrect');
          charSpan.classList.remove('correct');
          correct = false;
        }
      });

      quoteInput.className = correct ? 'correct' : 'incorrect';
      const totalTyped = arrayValue.length;
      const accuracy = totalTyped > 0 ? Math.floor((typedCorrect / totalTyped) * 100) : 100;
      accuracyDisplay.textContent = accuracy;

      if (arrayValue.length === arrayQuote.length && correct) {
        clearInterval(interval);
        quoteInput.disabled = true;
        const timeTaken = Math.floor((Date.now() - startTime) / 1000);
        const words = currentQuote.trim().split(/\s+/).length;
        const finalWPM = timeTaken > 0 ? Math.round((words / timeTaken) * 60) : 0;
        const username = usernameInput.value.trim();
        updateLeaderboard(username, finalWPM);
        updateHistory(finalWPM);
        renderLeaderboard();
        renderChart();
      }
    });

    function updateLeaderboard(name, wpm) {
      let leaderboard = JSON.parse(localStorage.getItem("leaderboard") || "[]");
      leaderboard.push({ name, wpm });
      leaderboard = leaderboard.sort((a, b) => b.wpm - a.wpm).slice(0, 5);
      localStorage.setItem("leaderboard", JSON.stringify(leaderboard));
    }

    function updateHistory(wpm) {
      let history = JSON.parse(localStorage.getItem("wpmHistory") || "[]");
      history.push(wpm);
      if (history.length > 10) history.shift();
      localStorage.setItem("wpmHistory", JSON.stringify(history));
    }

    function renderLeaderboard() {
      const leaderboard = JSON.parse(localStorage.getItem("leaderboard") || "[]");
      leaderboardList.innerHTML = leaderboard.map(e => `<li><span>${e.name}</span><span>${e.wpm} WPM</span></li>`).join('');
    }

    function renderChart() {
      const history = JSON.parse(localStorage.getItem("wpmHistory") || "[]");
      const maxWPM = Math.max(...history, 50);
      const barWidth = 40;
      const gap = 10;
      const chartWidth = history.length * (barWidth + gap);
      const chartHeight = 150;

      wpmChart.setAttribute("viewBox", `0 0 ${chartWidth} ${chartHeight}`);
      wpmChart.innerHTML = history.map((wpm, i) => {
        const barHeight = (wpm / maxWPM) * (chartHeight - 20);
        const x = i * (barWidth + gap);
        const y = chartHeight - barHeight;
        return `<rect class="bar" x="${x}" y="${y}" width="${barWidth}" height="${barHeight}"></rect>`;
      }).join('');
    }

    renderLeaderboard();
    renderChart();
  </script>
</body>
</html>
