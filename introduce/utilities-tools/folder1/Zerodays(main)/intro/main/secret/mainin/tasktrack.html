<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üóÇÔ∏è Kanban Task Tracker</title>
  <link rel="manifest" href="manifest.json">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
    background-image: url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSFVOZ2CsKQIPT0Lk06f5bNALaBIuEhMWppBg&s');
      color: #ff0000;
    }
    header {
      background: #0000006c;
      color: rgb(255, 0, 0);
      padding: 20px;
      text-align: center;
    }
    .container {
      max-width: 1200px;
      margin: 20px auto;
      padding: 10px;
    }
    .task-input, .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 20px;
    }
    input, select, button {
      padding: 10px;
      font-size: 1rem;
      border: 1px solid #ff0000;
      border-radius: 5px;
    }
    button {
      background: #ff0000;
      color: rgb(0, 255, 13);
      cursor: pointer;
      border: none;
    }
    button:hover {
      background: #00000091;
    }
    .kanban-board {
      display: flex;
      gap: 20px;
      justify-content: space-between;
      flex-wrap: wrap;
    }
    .column {
      flex: 1;
      min-width: 300px;
      background: #0000006c;
      border-radius: 10px;
      padding: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .column h3 {
      text-align: center;
    }
    .task {
      background: #0000007e;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 5px;
      cursor: grab;
    }
    .task-actions {
      margin-top: 5px;
      display: flex;
      justify-content: flex-end;
      gap: 5px;
    }
    .edit { background: #ffc107; }
    .delete { background: #dc3545; color: rgb(255, 0, 0); }
    .chatbox {
      margin-top: 20px;
      background: #00000071;
      border-radius: 10px;
      padding: 10px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
    }
    .chatbox input {
      width: 100%;
      padding: 10px;
      font-size: 1rem;
    }
    @media(max-width: 768px) {
      .kanban-board {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>üóÇÔ∏è Kanban Task Tracker</h1>
  </header>

  <div class="container">
    <div class="task-input">
      <input type="text" id="title" placeholder="Task Title" />
      <input type="date" id="date" />
      <select id="priority">
        <option value="Low">Low</option>
        <option value="Medium">Medium</option>
        <option value="High">High</option>
      </select>
      <input type="text" id="tag" placeholder="Tag (optional)">
      <button onclick="addTask()">Add Task</button>
    </div>

    <div class="controls">
      <button onclick="exportTasks()">üì§ Export JSON</button>
      <input type="file" id="importFile" onchange="importTasks(event)">
      <button onclick="exportToICS()">üìÖ Export iCal</button>
    </div>

    <div class="chatbox">
      <input type="text" id="chatInput" placeholder="Type: 'TaskName on YYYY-MM-DD with High priority'" onkeydown="handleChatInput(event)">
    </div>

    <div class="kanban-board">
      <div class="column" ondragover="allowDrop(event)" ondrop="drop(event, 'todo')">
        <h3>üìù To Do</h3>
        <div id="todo" class="task-column"></div>
      </div>
      <div class="column" ondragover="allowDrop(event)" ondrop="drop(event, 'inprogress')">
        <h3>üöß In Progress</h3>
        <div id="inprogress" class="task-column"></div>
      </div>
      <div class="column" ondragover="allowDrop(event)" ondrop="drop(event, 'done')">
        <h3>‚úÖ Done</h3>
        <div id="done" class="task-column"></div>
      </div>
    </div>
  </div>

  <script>
    let tasks = JSON.parse(localStorage.getItem('kanbanTasks')) || [];

    function saveTasks() {
      localStorage.setItem('kanbanTasks', JSON.stringify(tasks));
    }

    function addTask(title, date, priority, tag, status = 'todo') {
      if (!title || !date) return alert('Please fill all fields');
      tasks.push({ title, date, priority, tag, status });
      saveTasks();
      renderTasks();
      document.getElementById('title').value = '';
      document.getElementById('date').value = '';
      document.getElementById('tag').value = '';
    }

    function renderTasks() {
      ['todo', 'inprogress', 'done'].forEach(status => {
        const column = document.getElementById(status);
        column.innerHTML = '';
        tasks
          .filter(task => task.status === status)
          .forEach((task, index) => {
            const div = document.createElement('div');
            div.className = 'task';
            div.draggable = true;
            div.ondragstart = e => e.dataTransfer.setData('index', index);
            div.innerHTML = `
              <strong>${task.title}</strong><br>
              <small>${task.date} | ${task.priority} | ${task.tag || 'No Tag'}</small>
              <div class="task-actions">
                <button class="edit" onclick="editTask(${index})">Edit</button>
                <button class="delete" onclick="deleteTask(${index})">Delete</button>
              </div>
            `;
            column.appendChild(div);
          });
      });
    }

    function drop(e, status) {
      const index = e.dataTransfer.getData('index');
      tasks[index].status = status;
      saveTasks();
      renderTasks();
    }

    function editTask(index) {
      const t = tasks[index];
      const title = prompt("Edit Title:", t.title);
      const date = prompt("Edit Date:", t.date);
      const priority = prompt("Edit Priority:", t.priority);
      const tag = prompt("Edit Tag:", t.tag);
      if (title && date && priority) {
        tasks[index] = { ...tasks[index], title, date, priority, tag };
        saveTasks();
        renderTasks();
      }
    }

    function deleteTask(index) {
      if (confirm("Delete this task?")) {
        tasks.splice(index, 1);
        saveTasks();
        renderTasks();
      }
    }

    function exportTasks() {
      const data = JSON.stringify(tasks, null, 2);
      const blob = new Blob([data], { type: "application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "tasks.json";
      a.click();
    }

    function importTasks(event) {
      const file = event.target.files[0];
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const imported = JSON.parse(e.target.result);
          if (Array.isArray(imported)) {
            tasks = imported;
            saveTasks();
            renderTasks();
            alert("Tasks imported!");
          } else {
            alert("Invalid JSON");
          }
        } catch {
          alert("Import error");
        }
      };
      reader.readAsText(file);
    }

    function exportToICS() {
      let ics = `BEGIN:VCALENDAR\nVERSION:2.0\nCALSCALE:GREGORIAN\nMETHOD:PUBLISH\n`;
      tasks.forEach(t => {
        ics += `BEGIN:VEVENT\nSUMMARY:${t.title}\nDTSTART:${t.date.replace(/-/g, '')}T090000Z\nDESCRIPTION:Priority: ${t.priority}\nEND:VEVENT\n`;
      });
      ics += `END:VCALENDAR`;
      const blob = new Blob([ics], { type: 'text/calendar' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = "tasks.ics";
      a.click();
    }

    function handleChatInput(e) {
      if (e.key === "Enter") {
        const input = e.target.value.trim();
        const regex = /^(.+)\s+on\s+(\d{4}-\d{2}-\d{2})\s+with\s+(Low|Medium|High)\s+priority$/i;
        const match = input.match(regex);
        if (match) {
          addTask(match[1], match[2], match[3], '');
          e.target.value = '';
        } else {
          alert("Use format: TaskName on YYYY-MM-DD with High priority");
        }
      }
    }

    renderTasks();
  </script>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').then(() => {
        console.log("‚úÖ Service Worker registered");
      });
    }
  </script>
</body>
</html>
