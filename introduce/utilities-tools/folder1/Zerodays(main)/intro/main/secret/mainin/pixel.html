<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ¨ Advanced Pixel Art Studio Ultra+</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <style>
    body {
     background-image: url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSFVOZ2CsKQIPT0Lk06f5bNALaBIuEhMWppBg&s');
      color: #ff0000;
      font-family: monospace;
      padding: 20px;
      text-align: center;
    }
    h1 { color: #ff0000; }
    canvas {
      border: 1px solid #ff0000;
      background: #00000094;
      cursor: crosshair;
    }
    .controls, .toolset, .palette, .layers, .preview, .timeline {
      margin: 10px auto;
      max-width: 800px;
    }
    input, button, select {
      padding: 8px;
      margin: 5px;
      background: #0000007c;
      color: #ff0505;
      border: none;
      border-radius: 4px;
    }
    button:hover {
      background: #0000008c;
    }
    .preview canvas, .timeline canvas {
      width: 64px;
      height: 64px;
      border: 1px solid #ff0000;
      margin: 5px;
    }
    .palette button {
      width: 24px;
      height: 24px;
      border: 1px solid #ff0000;
      cursor: pointer;
    }
    .palette-selected {
      outline: 2px solid #ff0000;
    }
  </style>
</head>
<body>
<h1>ğŸ¨ Advanced Pixel Art Studio Ultra+</h1>

<div class="controls">
  <label>Width:</label><input type="number" id="cols" value="32" min="8" max="128">
  <label>Height:</label><input type="number" id="rows" value="32" min="8" max="128">
  <button onclick="initCanvas()">ğŸ§± Create</button>
  <input type="color" id="colorPicker" value="#38bdf8">
  <button onclick="undo()">â†©ï¸ Undo</button>
  <button onclick="redo()">â†ªï¸ Redo</button>
  <button onclick="exportPNG()">ğŸ“… PNG</button>
  <button onclick="addLayer()">ğŸ‹ï¸ Add Layer</button>
  <button onclick="addFrame()">â• Frame</button>
  <button onclick="exportZip()">ğŸ“¦ ZIP</button>
  <label><input type="checkbox" id="gridToggle" checked> Grid</label>
</div>

<div class="toolset">
  Tool:
  <select id="tool">
    <option value="pencil">ğŸ–Œï¸ Pencil</option>
    <option value="eraser">ğŸ§½ Eraser</option>
    <option value="fill">ğŸ§º Fill</option>
    <option value="gradient">ğŸŒˆ Gradient</option>
  </select>
</div>

<div class="palette" id="palette"></div>
<div class="layers" id="layerList"></div>
<div class="preview" id="animationPreview"></div>
<div class="timeline" id="timeline"></div>
<canvas id="pixelCanvas" width="512" height="512"></canvas>

<script>
const canvas = document.getElementById('pixelCanvas');
const ctx = canvas.getContext('2d');
let cols = 32, rows = 32, cellW, cellH;
let frames = [], currentFrame = 0;
let layers = [], activeLayer = 0;
let drawColor = "#38bdf8", tool = "pencil";
let undoStack = [], redoStack = [];

function initCanvas() {
  cols = +document.getElementById('cols').value;
  rows = +document.getElementById('rows').value;
  frames = [[Array(rows).fill().map(() => Array(cols).fill(null))]];
  currentFrame = 0;
  layers = frames[currentFrame];
  activeLayer = 0;
  drawAll();
  updateTimeline();
  updateLayerUI();
}

function addFrame() {
  const newFrame = JSON.parse(JSON.stringify(frames[currentFrame]));
  frames.push(newFrame);
  currentFrame = frames.length - 1;
  layers = frames[currentFrame];
  drawAll();
  updateTimeline();
  updateLayerUI();
}

function updateTimeline() {
  const timeline = document.getElementById('timeline');
  timeline.innerHTML = '';
  frames.forEach((_, i) => {
    const c = document.createElement('canvas');
    c.width = c.height = 64;
    const px = c.getContext('2d');
    px.fillStyle = "#1e293b";
    px.fillRect(0, 0, 64, 64);
    const frame = frames[i];
    frame.forEach(layer => {
      layer.forEach((row, y) => {
        row.forEach((color, x) => {
          if (color) {
            px.fillStyle = color;
            px.fillRect(x * 2, y * 2, 2, 2);
          }
        });
      });
    });
    c.onclick = () => {
      currentFrame = i;
      layers = frames[currentFrame];
      drawAll();
      updateLayerUI();
    };
    timeline.appendChild(c);
  });
}

function addLayer() {
  layers.push(Array(rows).fill().map(() => Array(cols).fill(null)));
  activeLayer = layers.length - 1;
  drawAll();
  updateLayerUI();
}

function drawAll() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  cellW = canvas.width / cols;
  cellH = canvas.height / rows;
  layers.forEach(layer => {
    for (let y = 0; y < rows; y++) {
      for (let x = 0; x < cols; x++) {
        if (layer[y][x]) {
          ctx.fillStyle = layer[y][x];
          ctx.fillRect(x * cellW, y * cellH, cellW, cellH);
        }
      }
    }
  });
  if (document.getElementById('gridToggle').checked) drawGrid();
}

function drawGrid() {
  ctx.strokeStyle = "#334155";
  for (let x = 0; x <= cols; x++) {
    ctx.beginPath();
    ctx.moveTo(x * cellW, 0);
    ctx.lineTo(x * cellW, canvas.height);
    ctx.stroke();
  }
  for (let y = 0; y <= rows; y++) {
    ctx.beginPath();
    ctx.moveTo(0, y * cellH);
    ctx.lineTo(canvas.width, y * cellH);
    ctx.stroke();
  }
}

canvas.addEventListener('click', e => {
  const rect = canvas.getBoundingClientRect();
  const x = Math.floor((e.clientX - rect.left) / cellW);
  const y = Math.floor((e.clientY - rect.top) / cellH);
  const layer = layers[activeLayer];
  saveState();
  if (tool === 'pencil') layer[y][x] = drawColor;
  else if (tool === 'eraser') layer[y][x] = null;
  else if (tool === 'fill') fill(layer, x, y, layer[y][x], drawColor);
  else if (tool === 'gradient') gradientFill(layer);
  drawAll();
});

function fill(layer, x, y, target, color) {
  if (x<0||y<0||x>=cols||y>=rows) return;
  if (layer[y][x] !== target || layer[y][x] === color) return;
  layer[y][x] = color;
  fill(layer,x+1,y,target,color); fill(layer,x-1,y,target,color);
  fill(layer,x,y+1,target,color); fill(layer,x,y-1,target,color);
}

function gradientFill(layer) {
  for (let y = 0; y < rows; y++) {
    for (let x = 0; x < cols; x++) {
      let r = Math.floor((x/cols)*255);
      layer[y][x] = `rgb(${r},${r},255)`;
    }
  }
}

function saveState() {
  undoStack.push(JSON.stringify(frames));
  redoStack = [];
}
function undo() {
  if (!undoStack.length) return;
  redoStack.push(JSON.stringify(frames));
  frames = JSON.parse(undoStack.pop());
  layers = frames[currentFrame];
  drawAll();
  updateLayerUI();
  updateTimeline();
}
function redo() {
  if (!redoStack.length) return;
  undoStack.push(JSON.stringify(frames));
  frames = JSON.parse(redoStack.pop());
  layers = frames[currentFrame];
  drawAll();
  updateLayerUI();
  updateTimeline();
}

function updateLayerUI() {
  const list = document.getElementById('layerList');
  list.innerHTML = '';
  layers.forEach((_, i) => {
    const btn = document.createElement('button');
    btn.textContent = 'Layer ' + i;
    if (i === activeLayer) btn.style.border = '2px solid #38bdf8';
    btn.onclick = () => { activeLayer = i; drawAll(); updateLayerUI(); };
    list.appendChild(btn);
  });
}

function exportPNG() {
  const link = document.createElement('a');
  link.download = 'pixel-art.png';
  link.href = canvas.toDataURL();
  link.click();
}

function exportZip() {
  const zip = new JSZip();
  const data = JSON.stringify({ frames, cols, rows });
  zip.file("project.pxa", data);
  zip.file("preview.png", canvas.toDataURL().split(",")[1], { base64: true });
  zip.generateAsync({ type: "blob" }).then(blob => {
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = "pixel-project.zip";
    link.click();
  });
}

document.getElementById('colorPicker').oninput = e => drawColor = e.target.value;
document.getElementById('tool').onchange = e => tool = e.target.value;
document.getElementById('gridToggle').onchange = drawAll;

const paletteColors = ['#38bdf8','#f87171','#facc15','#4ade80','#a78bfa','#f472b6','#fcd34d','#60a5fa'];
const paletteDiv = document.getElementById('palette');
paletteColors.forEach(c => {
  const btn = document.createElement('button');
  btn.style.background = c;
  btn.onclick = () => { drawColor = c; document.getElementById('colorPicker').value = c; };
  paletteDiv.appendChild(btn);
});

initCanvas();
</script>
</body>
</html>
