<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>üì¶ Image Compressor Pro - Batch + Presets</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-image: url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSFVOZ2CsKQIPT0Lk06f5bNALaBIuEhMWppBg&s');
      color: #ff0000;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
    }

    h1 {
      color: #ff0000;
      text-align: center;
    }

    input, select, button {
      margin: 10px 0;
      padding: 10px;
      font-size: 1rem;
      width: 100%;
      max-width: 320px;
    }

    label {
      text-align: left;
      width: 100%;
      max-width: 320px;
    }

    canvas {
      display: none;
    }

    button {
      background: #ff0000;
      color: #00ff40;
      border: none;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
    }

    button:hover {
      background: #00000079;
    }

    #dropZone {
      border: 2px dashed #ff0000;
      padding: 30px;
      margin-top: 20px;
      width: 100%;
      max-width: 320px;
      text-align: center;
      color: #ff0000;
    }

    #previewSize {
      font-size: 0.9rem;
      color: #ff0000;
      margin-top: 10px;
      max-width: 320px;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>üì¶ Batch Image Compressor Pro</h1>

  <div id="dropZone">üì§ Drag & Drop Images Here or Use File Input</div>
  <input type="file" id="imageInput" accept="image/*" multiple />

  <label>Resize Preset:</label>
  <select id="preset">
    <option value="original">Original Size</option>
    <option value="1920x1080">1080p (1920√ó1080)</option>
    <option value="1280x720">720p (1280√ó720)</option>
    <option value="854x480">480p (854√ó480)</option>
  </select>

  <label>Compression Format:</label>
  <select id="format">
    <option value="jpeg">JPEG</option>
    <option value="webp">WebP</option>
  </select>

  <label for="quality">Compression Quality: <span id="qualityLabel">0.8</span></label>
  <input type="range" id="quality" min="0.1" max="1" step="0.1" value="0.8" />

  <button onclick="compressAllImages()">‚öôÔ∏è Compress All & Download</button>
  <div id="previewSize"></div>
  <canvas id="canvas"></canvas>

  <script>
    const imageInput = document.getElementById('imageInput');
    const dropZone = document.getElementById('dropZone');
    const presetSelect = document.getElementById('preset');
    const formatSelect = document.getElementById('format');
    const qualitySlider = document.getElementById('quality');
    const qualityLabel = document.getElementById('qualityLabel');
    const previewSize = document.getElementById('previewSize');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    let fileQueue = [];

    // Drag and drop support
    dropZone.addEventListener('dragover', e => {
      e.preventDefault();
      dropZone.style.borderColor = '#38bdf8';
    });

    dropZone.addEventListener('dragleave', () => {
      dropZone.style.borderColor = '#64748b';
    });

    dropZone.addEventListener('drop', e => {
      e.preventDefault();
      dropZone.style.borderColor = '#64748b';
      fileQueue = [...e.dataTransfer.files];
    });

    imageInput.addEventListener('change', e => {
      fileQueue = [...e.target.files];
    });

    qualitySlider.addEventListener('input', () => {
      qualityLabel.textContent = qualitySlider.value;
    });

    function getPresetDimensions(originalWidth, originalHeight) {
      const val = presetSelect.value;
      if (val === 'original') return [originalWidth, originalHeight];
      const [w, h] = val.split('x').map(Number);
      return [w, h];
    }

    function compressAllImages() {
      if (!fileQueue.length) {
        alert("Please upload or drag and drop at least one image.");
        return;
      }

      let totalSize = 0;
      let processed = 0;

      fileQueue.forEach(file => {
        const reader = new FileReader();
        reader.onload = function (e) {
          const img = new Image();
          img.onload = () => {
            const [targetW, targetH] = getPresetDimensions(img.width, img.height);
            canvas.width = targetW;
            canvas.height = targetH;
            ctx.drawImage(img, 0, 0, targetW, targetH);

            const format = formatSelect.value;
            const quality = parseFloat(qualitySlider.value);
            const mime = `image/${format}`;

            canvas.toBlob(blob => {
              totalSize += blob.size;
              const url = URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url;
              a.download = `${file.name.split('.')[0]}_compressed.${format}`;
              a.click();

              processed++;
              if (processed === fileQueue.length) {
                previewSize.textContent = `‚úÖ All done! Total compressed size: ${(totalSize / 1024).toFixed(2)} KB`;
              }
            }, mime, quality);
          };
          img.src = e.target.result;
        };
        reader.readAsDataURL(file);
      });
    }
  </script>
</body>
</html>
