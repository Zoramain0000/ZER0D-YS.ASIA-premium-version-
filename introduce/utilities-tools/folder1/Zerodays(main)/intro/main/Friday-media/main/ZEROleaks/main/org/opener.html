<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Advanced Universal File Opener</title>
  <style>
    :root {
      --bg-light: #f5f5f5;
      --text-light: #222;
      --bg-dark: #121212;
      --text-dark: #ddd;
      --primary-color: #4a90e2;
    }
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg-light);
      color: var(--text-light);
      transition: background 0.3s, color 0.3s;
    }
    body.dark {
      background: var(--bg-dark);
      color: var(--text-dark);
    }
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 2rem;
      background: var(--primary-color);
      color: white;
    }
    header h1 {
      margin: 0;
      font-weight: 600;
    }
    #fileInputLabel, #loadFileBtn {
      cursor: pointer;
      background: white;
      color: var(--primary-color);
      padding: 0.5rem 1rem;
      border-radius: 4px;
      font-weight: 600;
      margin: 0.5rem;
      transition: background-color 0.3s;
      display: inline-block;
    }
    #fileInputLabel:hover, #loadFileBtn:hover {
      background: #e0e0e0;
    }
    input[type="file"] {
      display: none;
    }
    #dropZone {
      margin: 1rem auto;
      max-width: 700px;
      min-height: 180px;
      border: 3px dashed var(--primary-color);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary-color);
      font-weight: 600;
      font-size: 1.2rem;
      user-select: none;
      transition: background-color 0.3s;
    }
    #dropZone.dragover {
      background-color: rgba(74, 144, 226, 0.2);
    }
    #output {
      margin: 1rem auto;
      max-width: 90vw;
      max-height: 75vh;
      overflow: auto;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 1rem;
      background: white;
      color: black;
      font-family: monospace;
      white-space: pre-wrap;
    }
    body.dark #output {
      background: #222;
      color: #eee;
      border-color: #555;
    }
    img, video, audio, iframe {
      max-width: 100%;
      max-height: 70vh;
      display: block;
      margin: auto;
      border-radius: 8px;
      background: #000;
    }
    #toggleTheme {
      cursor: pointer;
      background: transparent;
      border: 2px solid white;
      color: white;
      padding: 0.3rem 0.8rem;
      border-radius: 5px;
      font-weight: 600;
      transition: background-color 0.3s;
    }
    #toggleTheme:hover {
      background-color: rgba(255 255 255 / 0.3);
    }
    #lookup {
      margin: 1rem auto;
      max-width: 700px;
      display: flex;
      gap: 0.5rem;
      align-items: center;
      justify-content: center;
    }
    #lookup input {
      padding: 0.5rem;
      flex: 1;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 1rem;
    }
  </style>
</head>
<body>
<header>
  <h1>Universal File Opener</h1>
  <button id="toggleTheme" title="Toggle Dark/Light Mode">Dark Mode</button>
</header>

<div id="lookup">
  <label for="fileInput" id="fileInputLabel">Select File</label>
  <input type="file" id="fileInput" />
  <input type="text" id="fileSearch" placeholder="Enter filename or URL" />
  <button id="loadFileBtn">Load</button>
</div>

<div id="dropZone">Or drag & drop any file here</div>

<div id="output" aria-live="polite" aria-atomic="true"></div>

<script>
const fileInput = document.getElementById('fileInput');
const output = document.getElementById('output');
const dropZone = document.getElementById('dropZone');
const toggleThemeBtn = document.getElementById('toggleTheme');
const fileSearch = document.getElementById('fileSearch');
const loadFileBtn = document.getElementById('loadFileBtn');

let openedFiles = new Map();

// Toggle dark mode
toggleThemeBtn.addEventListener('click', () => {
  document.body.classList.toggle('dark');
  toggleThemeBtn.textContent = document.body.classList.contains('dark') ? 'Light Mode' : 'Dark Mode';
});

// Utility functions
function escapeHtml(text) {
  return text.replace(/[&<>"']/g, m => ({
    '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;'
  })[m]);
}

function arrayBufferToBase64(buffer) {
  return btoa(String.fromCharCode(...new Uint8Array(buffer)));
}

function hexDump(buffer) {
  const bytes = new Uint8Array(buffer);
  const len = Math.min(bytes.length, 512);
  let hexStr = '';
  for (let i = 0; i < len; i += 16) {
    const row = bytes.slice(i, i + 16);
    const hex = Array.from(row).map(b => b.toString(16).padStart(2, '0')).join(' ');
    const ascii = Array.from(row).map(b => (b > 31 && b < 127) ? String.fromCharCode(b) : '.').join('');
    hexStr += hex.padEnd(48, ' ') + '  ' + ascii + '\n';
  }
  return hexStr;
}

async function handleFile(file) {
  output.innerHTML = `<p>Loading <strong>${file.name}</strong>...</p>`;
  openedFiles.set(file.name, file);
  output.innerHTML = '';

  const type = file.type;
  const url = URL.createObjectURL(file);

  if (type.startsWith('image/')) return output.innerHTML = `<img src="${url}" alt="Image Preview" />`;
  if (type.startsWith('audio/')) return output.innerHTML = `<audio controls src="${url}"></audio>`;
  if (type.startsWith('video/')) return output.innerHTML = `<video controls src="${url}"></video>`;
  if (type === 'application/pdf') return output.innerHTML = `<iframe src="${url}" style="width:100%;height:70vh;"></iframe>`;

  if (type.startsWith('text/') || /\.(txt|json|js|css|html|xml|csv|md|log)$/i.test(file.name)) {
    const reader = new FileReader();
    reader.onload = () => output.innerHTML = `<pre>${escapeHtml(reader.result)}</pre>`;
    reader.readAsText(file);
    return;
  }

  const reader = new FileReader();
  reader.onload = () => {
    const buffer = reader.result;
    const hex = hexDump(buffer);
    const base64 = arrayBufferToBase64(buffer);
    output.innerHTML = `
      <h3>Hex Preview (first 512 bytes):</h3>
      <pre>${hex}</pre>
      <p><a href="data:application/octet-stream;base64,${base64}" download="${file.name}">Download</a></p>`;
  };
  reader.readAsArrayBuffer(file);
}

// Events
fileInput.addEventListener('change', e => {
  if (e.target.files.length) handleFile(e.target.files[0]);
});
dropZone.addEventListener('dragover', e => {
  e.preventDefault();
  dropZone.classList.add('dragover');
});
dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
dropZone.addEventListener('drop', e => {
  e.preventDefault();
  dropZone.classList.remove('dragover');
  if (e.dataTransfer.files.length) handleFile(e.dataTransfer.files[0]);
});

loadFileBtn.addEventListener('click', async () => {
  const val = fileSearch.value.trim();
  if (!val) return;

  if (openedFiles.has(val)) {
    handleFile(openedFiles.get(val));
    return;
  }

  // Attempt to load from remote URL
  try {
    const res = await fetch(val);
    if (!res.ok) throw new Error('Failed to fetch file');
    const blob = await res.blob();
    const file = new File([blob], val.split('/').pop(), { type: blob.type });
    handleFile(file);
  } catch (e) {
    output.innerHTML = `<p>Error loading file: ${e.message}</p>`;
  }
});
</script>
</body>
</html>
