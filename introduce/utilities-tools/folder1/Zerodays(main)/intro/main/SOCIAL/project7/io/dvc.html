<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üì± Smart Contact App </title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
background-image: url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSFVOZ2CsKQIPT0Lk06f5bNALaBIuEhMWppBg&s');
      color: #111827;
    }
    header {
background: rgba(0, 0, 0, 0.5);
      color: red;
      padding: 1rem;
      text-align: center;
      font-size: 1.5rem;
    }
    #app {
      padding: 1rem;
    }
    .search {
      width: 100%;
      padding: 0.5rem;
      margin-bottom: 1rem;
      border: 1px solid red;
      border-radius: 6px;
    }
    .contact {
background: rgba(0, 0, 0, 0.5);
      border-radius: 8px;
      margin-bottom: 1rem;
      padding: 1rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      color: red;
    }
    .contact h3 {
      margin: 0;
      font-size: 1.2rem;
      color: red;
    }
    .contact p {
      margin: 0.25rem 0;
      font-size: 0.95rem;
      color: red;
    }
    .contact .actions {
      margin-top: 0.5rem;
      display: flex;
      gap: 0.5rem;
    }
    .contact .map {
      height: 200px;
      margin-top: 0.5rem;
      border-radius: 8px;
    }
    button {
      cursor: pointer;
      padding: 0.5rem 0.75rem;
      border: none;
      border-radius: 6px;
      font-size: 0.9rem;
      background: red;
      color: green;
    }
    
    button:hover{
background: rgba(0, 0, 0, 0.5);
    }
    .add-btn { background: red; color: green; margin-bottom: 1rem; }
    .edit-btn { background: red; color: green; }
    .delete-btn { background: red; color: green; }
    .export-btn, .import-btn, .csv-btn {
      background: red;
      color: green;
      margin-top: 0.5rem;
      margin-right: 0.5rem;
    }
.export-btn:hover, .import-btn:hover, .csv-btn:hover{
background: rgba(0, 0, 0, 0.5);
} 
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      justify-content: center;
      align-items: center;
    }
    .modal.active {
      display: flex;
    }
    .modal-content {
background: rgba(0, 0, 0, 0.5);
      padding: 1.5rem;
      border-radius: 10px;
      width: 90%;
      max-width: 400px;
    }
    .modal-content input {
      width: 100%;
      padding: 0.5rem;
      margin: 0.5rem 0;
      border: 1px solid red;
      border-radius: 6px;
    }
    .modal-content .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 0.5rem;
    }
  </style>
</head>
<body>
<header>üìá Smart Contact App </header>
<div id="app">
  <input class="search" type="text" id="search" placeholder="Search contacts..." />
  <button class="add-btn" onclick="openModal()">+ Add Contact</button>
  <input type="file" id="fileInput" accept=".json,.csv" style="display:none" />
  <button class="import-btn" onclick="document.getElementById('fileInput').click()">Import</button>
  <button class="export-btn" onclick="exportContacts()">Export JSON</button>
  <button class="csv-btn" onclick="exportCSV()">Export CSV</button>
  <div id="contacts"></div>
</div>

<!-- Modal -->
<div class="modal" id="modal">
  <div class="modal-content">
    <h3 id="modalTitle">Add Contact</h3>
    <input type="text" id="name" placeholder="Name" style="color:red;" />
    <input type="tel" id="phone" placeholder="Phone Number (+countrycode...)" style="color:red;" />
    <input type="email" id="email" placeholder="Email (optional)" />
    <div class="modal-actions">
      <button onclick="closeModal()">Cancel</button>
      <button onclick="saveContact()">Save</button>
    </div>
  </div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  let contacts = JSON.parse(localStorage.getItem("contacts") || "[]");
  let editIndex = null;

  async function saveContact() {
    const name = document.getElementById("name").value.trim();
    const phone = document.getElementById("phone").value.trim();
    const email = document.getElementById("email").value.trim();
    if (!name || !phone) {
      alert("Name and phone are required.");
      return;
    }

    const contact = { name, phone, email };
    try {
      const coords = await locateByPhone(phone);
      if (coords) {
        contact.lat = coords.lat;
        contact.lon = coords.lon;
      } else {
        // fallback browser location
        try {
          const pos = await new Promise((res, rej) => {
            navigator.geolocation.getCurrentPosition(res, rej, { timeout: 5000 });
          });
          contact.lat = pos.coords.latitude;
          contact.lon = pos.coords.longitude;
        } catch { }
      }
    } catch { }

    if (editIndex !== null) {
      contacts[editIndex] = { ...contacts[editIndex], ...contact };
    } else {
      contacts.push(contact);
    }

    localStorage.setItem("contacts", JSON.stringify(contacts));
    closeModal();
    renderContacts(document.getElementById("search").value);
  }

  async function locateByPhone(phone) {
    const API_KEY = "YOUR_API_KEY"; // Replace this!
    const url = `https://numverify.com/api/validate?access_key=${API_KEY}&number=${encodeURIComponent(phone)}`;
    try {
      const res = await fetch(url);
      const data = await res.json();
      if (data && data.location && data.country_code) {
        const geo = await fetch(`https://restcountries.com/v3.1/alpha/${data.country_code}`).then(r => r.json());
        const latlng = geo[0]?.latlng;
        if (latlng) return { lat: latlng[0], lon: latlng[1] };
      }
    } catch (e) {
      console.warn("Phone geolocation failed:", e);
    }
    return null;
  }

  function renderContacts(filter = "") {
    const container = document.getElementById("contacts");
    container.innerHTML = "";
    contacts
      .filter(c => c.name.toLowerCase().includes(filter.toLowerCase()))
      .forEach((c, i) => {
        const el = document.createElement("div");
        el.className = "contact";
        el.innerHTML = `
          <h3>${c.name}</h3>
          <p>üìû <a href="tel:${c.phone}">${c.phone}</a></p>
          ${c.email ? `<p>‚úâÔ∏è ${c.email}</p>` : ""}
          ${c.lat && c.lon ? `<div id="map${i}" class="map"></div>` : ""}
          <div class="actions">
            <button class="edit-btn" onclick="editContact(${i})">Edit</button>
            <button class="delete-btn" onclick="deleteContact(${i})">Delete</button>
          </div>
        `;
        container.appendChild(el);
        if (c.lat && c.lon) {
          const map = L.map(`map${i}`, { scrollWheelZoom: false }).setView([c.lat, c.lon], 6);
          L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
          L.marker([c.lat, c.lon]).addTo(map);
        }
      });
  }

  function openModal(editing = false) {
    document.getElementById("modal").classList.add("active");
    document.getElementById("modalTitle").innerText = editing ? "Edit Contact" : "Add Contact";
  }

  function closeModal() {
    document.getElementById("modal").classList.remove("active");
    document.getElementById("name").value = "";
    document.getElementById("phone").value = "";
    document.getElementById("email").value = "";
    editIndex = null;
  }

  function editContact(index) {
    editIndex = index;
    const c = contacts[index];
    document.getElementById("name").value = c.name;
    document.getElementById("phone").value = c.phone;
    document.getElementById("email").value = c.email || "";
    openModal(true);
  }

  function deleteContact(index) {
    if (confirm("Delete this contact?")) {
      contacts.splice(index, 1);
      localStorage.setItem("contacts", JSON.stringify(contacts));
      renderContacts(document.getElementById("search").value);
    }
  }

  function exportContacts() {
    const blob = new Blob([JSON.stringify(contacts, null, 2)], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "contacts.json";
    a.click();
  }

  function exportCSV() {
    let csv = "Name,Phone,Email,Latitude,Longitude\n";
    contacts.forEach(c => {
      csv += `"${c.name}","${c.phone}","${c.email || ''}","${c.lat || ''}","${c.lon || ''}"\n`;
    });
    const blob = new Blob([csv], { type: "text/csv" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "contacts.csv";
    a.click();
  }

  function importContacts(file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      try {
        let imported;
        if (file.name.endsWith(".json")) {
          imported = JSON.parse(e.target.result);
        } else if (file.name.endsWith(".csv")) {
          imported = csvToContacts(e.target.result);
        }
        if (Array.isArray(imported)) {
          contacts = contacts.concat(imported);
          localStorage.setItem("contacts", JSON.stringify(contacts));
          renderContacts(document.getElementById("search").value);
        }
      } catch (err) {
        alert("Import failed: " + err.message);
      }
    };
    reader.readAsText(file);
  }

  function csvToContacts(csv) {
    const lines = csv.trim().split("\n").slice(1);
    return lines.map(line => {
      const [name, phone, email, lat, lon] = line.split(",");
      return {
        name: name.replace(/(^"|"$)/g, "").trim(),
        phone: phone.replace(/(^"|"$)/g, "").trim(),
        email: (email || "").replace(/(^"|"$)/g, "").trim(),
        lat: parseFloat(lat) || null,
        lon: parseFloat(lon) || null
      };
    });
  }

  document.getElementById("fileInput").addEventListener("change", (e) => {
    const file = e.target.files[0];
    if (file) importContacts(file);
    e.target.value = "";
  });

  document.getElementById("search").addEventListener("input", (e) => {
    renderContacts(e.target.value);
  });

  renderContacts();
</script>
</body>
</html>
