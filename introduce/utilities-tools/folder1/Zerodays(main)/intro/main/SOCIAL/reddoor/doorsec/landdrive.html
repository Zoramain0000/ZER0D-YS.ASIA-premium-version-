<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Landmark Finder (With Filters & Favorites)</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
background-image: url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSFVOZ2CsKQIPT0Lk06f5bNALaBIuEhMWppBg&s');
      padding: 20px;
    }

    h1, h2{
      text-align: center;
      margin-bottom: 20px
      color: red;
    }

    .search-container {
      max-width: 800px;
      margin: 0 auto 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
      justify-content: center;
    }

    input[type="text"], select {
      padding: 12px;
      font-size: 16px;
      border-radius: 8px;
      border: 2px solid red;
    }

    button {
      padding: 12px 16px;
      font-size: 16px;
      background: red;
      color: green;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }

    button:hover {
background: rgba(0, 0, 0, 0.5);
    }

    #map {
      height: 400px;
      margin: 30px 0;
      border-radius: 10px;
    }

    .results {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 20px;
    }

    .card {
background: rgba(0, 0, 0, 0.5);
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      position: relative;
    }

    .card:hover {
      transform: scale(1.02);
    }

    .card img {
      width: 100%;
      border-radius: 8px;
      margin-bottom: 10px;
      object-fit: cover;
      max-height: 180px;
    }

    .card h3 {
      margin: 10px 0 5px;
      font-size: 18px;
    }

    .card p {
      font-size: 14px;
      color: red;
      max-height: 100px;
      overflow: hidden;
    }

    .card a {
      display: inline-block;
      margin-top: 10px;
      color: red;
      text-decoration: none;
      font-weight: bold;
    }

    .save-btn {
      position: absolute;
      top: 10px;
      right: 10px;
background: rgba(0, 0, 0, 0.5);
      border: none;
      padding: 6px 10px;
      font-size: 12px;
      cursor: pointer;
      border-radius: 6px;
    }

    .error, .loading {
      text-align: center;
      margin-top: 20px;
      font-weight: bold;
    }

    .favorites {
      max-width: 800px;
      margin: 30px auto;
    }

    .favorites h2 {
      text-align: center;
      margin-bottom: 10px;
    }

    .favorite-item {
background: rgba(0, 0, 0, 0.5);
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .favorite-item img {
      width: 60px;
      height: 40px;
      object-fit: cover;
      border-radius: 6px;
      margin-right: 10px;
    }

    .fav-info {
      flex: 1;
      margin-left: 10px;
    }

    .remove-btn {
      background: red;
      color: green;
      border: none;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
    }

    .remove-btn:hover {
background: rgba(0, 0, 0, 0.5);
    }

    .export-btn {
      margin-top: 20px;
      background: red;
      color: green;
    }

    .export-btn:hover {
background: rgba(0, 0, 0, 0.5);
    }

    .filter-favorites {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 10px;
    }
  </style>
</head>
<body>
  <h1 style="color:red;">Landmark Finder (With Filters & Favorites)</h1>

  <div class="search-container">
    <input type="text" id="searchInput" placeholder="Search landmark..." />
    <select id="continentFilter">
      <option value="">All Continents</option>
      <option value="Africa">Africa</option>
      <option value="Europe">Europe</option>
      <option value="Asia">Asia</option>
      <option value="North America">North America</option>
      <option value="South America">South America</option>
      <option value="Oceania">Oceania</option>
    </select>
<select id="typeFilter">
  <option value="">All Types</option>
  
  <!-- Monuments -->
  <optgroup label="Monuments">
    <option value="Monument">Monument</option>
    <option value="Statue">Statue</option>
    <option value="War Memorial">War Memorial</option>
    <option value="Fountain">Fountain</option>
    <option value="Obelisk">Obelisk</option>
    <option value="Arch">Arch</option>
    <option value="Sculpture">Sculpture</option>
  </optgroup>
  
  <!-- Buildings -->
  <optgroup label="Buildings">
    <option value="Building">Building</option>
    <option value="Castle">Castle</option>
    <option value="Palace">Palace</option>
    <option value="Skyscraper">Skyscraper</option>
    <option value="Temple">Temple</option>
    <option value="Mosque">Mosque</option>
    <option value="Cathedral">Cathedral</option>
    <option value="Church">Church</option>
    <option value="Museum">Museum</option>
    <option value="Fortress">Fortress</option>
  </optgroup>
  
  <!-- Natural -->
  <optgroup label="Natural">
    <option value="Natural">Natural</option>
    <option value="Mountain">Mountain</option>
    <option value="Waterfall">Waterfall</option>
    <option value="River">River</option>
    <option value="Lake">Lake</option>
    <option value="Forest">Forest</option>
    <option value="Desert">Desert</option>
    <option value="Volcano">Volcano</option>
    <option value="Cave">Cave</option>
    <option value="Island">Island</option>
  </optgroup>
  
  <!-- Cultural and Miscellaneous -->
  <optgroup label="Cultural & Miscellaneous">
    <option value="UNESCO Heritage Site">UNESCO Heritage Site</option>
    <option value="Park">Park</option>
    <option value="Garden">Garden</option>
    <option value="Historic District">Historic District</option>
    <option value="Archaeological Site">Archaeological Site</option>
    <option value="Market">Market</option>
  </optgroup>
</select>

    </select>
    <select id="ratingFilter">
      <option value="">All Ratings</option>
      <option value="4">4‚òÖ+</option>
      <option value="3">3‚òÖ+</option>
    </select>
    <button onclick="startSearch()">Search</button>
  </div>

  <div id="map"></div>
  <div class="results" id="resultsContainer"></div>
  <div id="errorMsg" class="error"></div>
  <div id="loading" class="loading"></div>

  <div class="favorites">
    <h2 style="color:red;">‚≠ê Saved Favorites</h2>
    <div class="filter-favorites">
      <input type="text" id="favoriteFilterInput" placeholder="Filter favorites..." />
      <button onclick="filterFavorites()">Filter</button>
    </div>
    <div id="favoritesList"></div>
    <button class="export-btn" onclick="exportFavorites()">Export Favorites</button>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    let offset = 0;
    let currentQuery = '';
    let isLoading = false;
    let map, markersLayer;

    function initMap() {
      map = L.map('map').setView([20, 0], 2);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors'
      }).addTo(map);
      markersLayer = L.layerGroup().addTo(map);
    }

    async function startSearch() {
      const query = document.getElementById('searchInput').value.trim();
      const resultsContainer = document.getElementById('resultsContainer');
      const errorMsg = document.getElementById('errorMsg');
      const loading = document.getElementById('loading');
      resultsContainer.innerHTML = '';
      errorMsg.textContent = '';
      offset = 0;
      currentQuery = query;
      markersLayer.clearLayers();

      if (!query) {
        errorMsg.textContent = 'Please enter a landmark name.';
        return;
      }

      await fetchAndDisplayResults();
    }

    async function fetchAndDisplayResults() {
      if (isLoading) return;
      isLoading = true;
      document.getElementById('loading').textContent = 'Loading...';

      const searchUrl = `https://en.wikipedia.org/w/api.php?origin=*&action=query&list=search&srsearch=${encodeURIComponent(currentQuery)}&srlimit=10&sroffset=${offset}&utf8=&format=json`;

      try {
        const res = await fetch(searchUrl);
        const data = await res.json();
        const results = data.query.search;
        if (!results.length) {
          if (offset === 0) document.getElementById('errorMsg').textContent = 'No results found.';
          document.getElementById('loading').textContent = '';
          isLoading = false;
          return;
        }

        const continent = document.getElementById('continentFilter').value;
        const type = document.getElementById('typeFilter').value;
        const minRating = parseInt(document.getElementById('ratingFilter').value) || 0;

        for (const item of results) {
          const pageId = item.pageid;
          const pageTitle = item.title;

          const detailUrl = `https://en.wikipedia.org/w/api.php?origin=*&action=query&pageids=${pageId}&prop=pageimages|extracts&exintro&explaintext&format=json&pithumbsize=400`;

          const detailRes = await fetch(detailUrl);
          const detailData = await detailRes.json();
          const page = detailData.query.pages[pageId];
          const img = page.thumbnail ? page.thumbnail.source : 'https://via.placeholder.com/400x250?text=No+Image';
          const extract = page.extract || 'No description available.';
          const latLon = await geocodeLocation(page.title);

          const randomType = ['Monument', 'Building', 'Natural'][Math.floor(Math.random() * 3)];
          const randomRating = (Math.random() * 2 + 3).toFixed(1);
          const randomContinent = ['Africa','Europe','Asia','North America','South America','Oceania'][Math.floor(Math.random() * 6)];

          if ((continent && continent !== randomContinent) || (type && type !== randomType) || (parseFloat(randomRating) < minRating)) continue;

          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <img src="${img}" alt="${pageTitle}" />
            <h3>${pageTitle}</h3>
            <p>${extract}</p>
            <small>üåç ${randomContinent} | üìå ${randomType} | ‚≠ê ${randomRating}</small><br>
            <a href="https://en.wikipedia.org/?curid=${pageId}" target="_blank">Read more</a>
            <button class="save-btn" onclick="saveFavorite('${pageTitle}', '${img}', \`${extract}\`, '${pageId}')">Save</button>
          `;
          document.getElementById('resultsContainer').appendChild(card);

          if (latLon) {
            L.marker([latLon.lat, latLon.lon])
              .bindPopup(`<strong>${pageTitle}</strong><br>${extract.substring(0, 100)}...`)
              .addTo(markersLayer);
          }
        }

        offset += 10;
      } catch (err) {
        console.error(err);
        document.getElementById('errorMsg').textContent = 'An error occurred. Please try again later.';
      } finally {
        document.getElementById('loading').textContent = '';
        isLoading = false;
      }
    }

    async function geocodeLocation(place) {
      try {
        const geoUrl = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(place)}`;
        const res = await fetch(geoUrl);
        const data = await res.json();
        if (data && data.length) {
          return { lat: parseFloat(data[0].lat), lon: parseFloat(data[0].lon) };
        }
      } catch {
        console.warn('Geocoding failed:', place);
      }
      return null;
    }

    function saveFavorite(title, img, extract, pageId) {
      const favorites = JSON.parse(localStorage.getItem('landmarkFavorites') || '[]');
      if (favorites.find(fav => fav.pageId === pageId)) return alert('Already saved.');
      favorites.push({ title, img, extract, pageId });
      localStorage.setItem('landmarkFavorites', JSON.stringify(favorites));
      loadFavorites();
    }

    function loadFavorites() {
      const favorites = JSON.parse(localStorage.getItem('landmarkFavorites') || '[]');
      const container = document.getElementById('favoritesList');
      container.innerHTML = '';
      favorites.forEach((fav, index) => {
        const div = document.createElement('div');
        div.className = 'favorite-item';
        div.innerHTML = `
          <img src="${fav.img}" alt="${fav.title}" />
          <div class="fav-info">
            <strong>${fav.title}</strong><br>
            <small>${fav.extract.substring(0, 80)}...</small><br>
            <a href="https://en.wikipedia.org/?curid=${fav.pageId}" target="_blank">Read More</a>
          </div>
          <button class="remove-btn" onclick="removeFavorite(${index})">Remove</button>
        `;
        container.appendChild(div);
      });
    }

    function removeFavorite(index) {
      const favorites = JSON.parse(localStorage.getItem('landmarkFavorites') || '[]');
      favorites.splice(index, 1);
      localStorage.setItem('landmarkFavorites', JSON.stringify(favorites));
      loadFavorites();
    }

    function filterFavorites() {
      const filterValue = document.getElementById('favoriteFilterInput').value.toLowerCase();
      const favorites = JSON.parse(localStorage.getItem('landmarkFavorites') || '[]');
      const container = document.getElementById('favoritesList');
      container.innerHTML = '';
      favorites.forEach((fav, index) => {
        if (fav.title.toLowerCase().includes(filterValue)) {
          const div = document.createElement('div');
          div.className = 'favorite-item';
          div.innerHTML = `
            <img src="${fav.img}" alt="${fav.title}" />
            <div class="fav-info">
              <strong>${fav.title}</strong><br>
              <small>${fav.extract.substring(0, 80)}...</small><br>
              <a href="https://en.wikipedia.org/?curid=${fav.pageId}" target="_blank">Read More</a>
            </div>
            <button class="remove-btn" onclick="removeFavorite(${index})">Remove</button>
          `;
          container.appendChild(div);
        }
      });
    }

    function exportFavorites() {
      const favorites = JSON.parse(localStorage.getItem('landmarkFavorites') || '[]');
      const dataStr = JSON.stringify(favorites, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'favorites.json';
      a.click();
      URL.revokeObjectURL(url);
    }

    window.onload = () => {
      initMap();
      loadFavorites();
    };
  </script>
</body>
</html>
