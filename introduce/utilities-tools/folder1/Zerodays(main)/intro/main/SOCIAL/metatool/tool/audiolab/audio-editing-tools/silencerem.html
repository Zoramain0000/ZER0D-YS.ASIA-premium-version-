<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Silence Removal Tool </title>
<style>
  body {
background-image: url('https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSFVOZ2CsKQIPT0Lk06f5bNALaBIuEhMWppBg&s');
    color: red;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0; padding: 0;
    display: flex; flex-direction: column; align-items: center;
    min-height: 100vh;
  }
  header {
    padding: 1rem;
    font-size: 1.5rem;
    font-weight: bold;
  }
  main {
background: rgba(0, 0, 0, 0.5);
    border-radius: 8px;
    padding: 1rem;
    width: 90%;
    max-width: 600px;
    box-sizing: border-box;
  }
  input[type="file"] {
    margin-bottom: 1rem;
    width: 100%;
background: rgba(0, 0, 0, 0.5);
  }
  audio {
    width: 100%;
    margin-bottom: 1rem;
background: rgba(0, 0, 0, 0.5);
  }
  label {
    display: block;
    margin: 0.5rem 0 0.2rem;
background: rgba(0, 0, 0, 0.5);
  }
  .radio-group {
    margin-bottom: 1rem;
  }
  .radio-group label {
    display: block;
    margin: 0.3rem 0;
    cursor: pointer;
  }
  select, button {
    width: 100%;
    padding: 0.5rem;
    margin-bottom: 1rem;
    border-radius: 4px;
    border: none;
    font-size: 1rem;
  }
  button {
    background: red;
    color: green;
    cursor: pointer;
  }
  button:disabled {
background: rgba(0, 0, 0, 0.5);
    cursor: not-allowed;
  }
  #status {
    text-align: center;
    margin-bottom: 1rem;
  }
</style>
</head>
<body>
<header>Silence Removal Tool </header>
<main>
  <input type="file" id="audioFile" accept="audio/*" />
  <audio id="audioPlayer" controls></audio>

  <div class="radio-group" id="silenceOptions">
    <label><input type="radio" name="silence" value="original" checked /> Original Audio</label>
    <label><input type="radio" name="silence" value="removeAll" /> Remove all silence</label>
    <label><input type="radio" name="silence" value="removeStart" /> Remove silence from beginning</label>
    <label><input type="radio" name="silence" value="removeEnd" /> Remove silence from end</label>
    <label><input type="radio" name="silence" value="removeStartEnd" /> Remove silence from beginning and end</label>
  </div>

  <label for="useAs">Use As</label>
  <select id="useAs">
    <option>Music</option>
    <option>Podcast</option>
    <option>Lecture</option>
    <option>Other</option>
  </select>

  <button id="processBtn" disabled>Process Audio</button>

  <div id="status"></div>
</main>

<script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
<script>
  const { createFFmpeg, fetchFile } = FFmpeg;
  const ffmpeg = createFFmpeg({ log: true });

  const audioFileInput = document.getElementById('audioFile');
  const audioPlayer = document.getElementById('audioPlayer');
  const processBtn = document.getElementById('processBtn');
  const status = document.getElementById('status');

  let selectedFile = null;
  let originalAudioUrl = null;

  audioFileInput.addEventListener('change', (e) => {
    if (e.target.files.length === 0) return;
    selectedFile = e.target.files[0];
    if (originalAudioUrl) URL.revokeObjectURL(originalAudioUrl);
    originalAudioUrl = URL.createObjectURL(selectedFile);
    audioPlayer.src = originalAudioUrl;
    processBtn.disabled = false;
    status.textContent = 'Ready to process audio.';
  });

  function getSelectedSilenceOption() {
    const options = document.getElementsByName('silence');
    for (const option of options) {
      if (option.checked) return option.value;
    }
    return 'original';
  }

  async function runFFmpegSilenceRemoval(inputName, outputName, option) {
    // Silence removal filter strings for ffmpeg
    // Using silenceremove filter: https://ffmpeg.org/ffmpeg-filters.html#silenceremove
    // Parameters: start_periods, start_duration, start_threshold, stop_periods, stop_duration, stop_threshold
    // We'll use a threshold of -50dB and duration 0.5s for silence detection

    let filter = '';

    switch(option) {
      case 'removeAll':
        // Remove all silence segments
        filter = 'silenceremove=stop_periods=-1:stop_duration=0.5:stop_threshold=-50dB';
        break;
      case 'removeStart':
        // Remove silence from beginning only
        filter = 'silenceremove=start_periods=1:start_duration=0.5:start_threshold=-50dB';
        break;
      case 'removeEnd':
        // Remove silence from end only
        filter = 'silenceremove=stop_periods=1:stop_duration=0.5:stop_threshold=-50dB';
        break;
      case 'removeStartEnd':
        // Remove silence from beginning and end
        filter = 'silenceremove=start_periods=1:start_duration=0.5:start_threshold=-50dB, silenceremove=stop_periods=1:stop_duration=0.5:stop_threshold=-50dB';
        break;
      default:
        filter = ''; // no filter
    }

    if (filter === '') {
      // Just copy input to output
      await ffmpeg.run('-i', inputName, '-c', 'copy', outputName);
    } else {
      await ffmpeg.run('-i', inputName, '-af', filter, '-c:a', 'libmp3lame', '-b:a', '192k', outputName);
    }
  }

  processBtn.addEventListener('click', async () => {
    if (!selectedFile) return;
    processBtn.disabled = true;
    status.textContent = 'Loading FFmpeg...';

    if (!ffmpeg.isLoaded()) {
      await ffmpeg.load();
    }

    status.textContent = 'Processing audio...';

    const inputName = 'input.' + selectedFile.name.split('.').pop();
    const outputName = 'output.mp3';

    ffmpeg.FS('writeFile', inputName, await fetchFile(selectedFile));

    const option = getSelectedSilenceOption();

    try {
      await runFFmpegSilenceRemoval(inputName, outputName, option);

      const data = ffmpeg.FS('readFile', outputName);
      const blob = new Blob([data.buffer], { type: 'audio/mp3' });
      const url = URL.createObjectURL(blob);

      audioPlayer.src = url;
      status.textContent = 'Processing complete. You can play or download the processed audio.';

      let downloadLink = document.getElementById('downloadLink');
      if (!downloadLink) {
        downloadLink = document.createElement('a');
        downloadLink.id = 'downloadLink';
        downloadLink.style.display = 'block';
        downloadLink.style.color = '#4caf50';
        downloadLink.style.marginTop = '1rem';
        downloadLink.textContent = 'Download Processed Audio (MP3)';
        document.querySelector('main').appendChild(downloadLink);
      }
      downloadLink.href = url;
      downloadLink.download = selectedFile.name.replace(/\.[^/.]+$/, '') + '_nosilence.mp3';
    } catch (err) {
      status.textContent = 'Error during processing: ' + err.message;
    } finally {
      processBtn.disabled = false;
    }
  });
</script>
</body>
</html>