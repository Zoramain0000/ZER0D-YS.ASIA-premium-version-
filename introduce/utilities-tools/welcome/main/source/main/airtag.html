<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Ultimate Airtag Scanner | Real-time Device Detection</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

<style>
:root {
  --bg:#010204;
  --panel:#0a0c12;
  --border:#1f2937;
  --accent:#00d4ff;
  --danger:#ff2e63;
  --success:#08f7af;
  --warning:#f59e0b;
  --text:#94a3b8;
  --highlight:#f8fafc;
}

* { box-sizing:border-box; font-family: 'Courier New', Courier, monospace; outline: none; }

body {
  margin:0;
  background:var(--bg);
  color:var(--text);
  height: 100vh;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* System Header */
.system-status {
  padding: 12px;
  background: var(--panel);
  border-bottom: 2px solid var(--accent);
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 10px;
  text-transform: uppercase;
  z-index: 100;
}

.radar-vitals { color: var(--accent); font-weight: bold; letter-spacing: 1px; }
.live-pulse { color: var(--success); }
.live-pulse::before { content: "‚óè"; margin-right: 5px; animation: blink 0.8s infinite; }
@keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.1; } }

/* Device Scanner Viewport */
.scanner-viewport {
  width: 100%;
  aspect-ratio: 1 / 1;
  position: relative;
  background: #000;
  border-bottom: 1px solid var(--border);
  display: flex;
  align-items: center;
  justify-content: center;
  overflow: hidden;
}

.scanner-grid {
    position: absolute;
    width: 200%; height: 200%;
    background-image: linear-gradient(var(--border) 1px, transparent 1px), linear-gradient(90deg, var(--border) 1px, transparent 1px);
    background-size: 40px 40px;
    transform: rotateX(60deg);
    opacity: 0.2;
}

#scan-beam {
  position: absolute;
  width: 160%; height: 160%;
  background: conic-gradient(from 0deg at 50% 50%, rgba(0, 212, 255, 0.2) 0deg, transparent 90deg);
  animation: rotate 3s linear infinite;
  z-index: 2;
}

@keyframes rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

.scanner-beacon {
    z-index: 10;
    width: 10px; height: 10px;
    background: var(--accent);
    border-radius: 50%;
    box-shadow: 0 0 15px var(--accent);
    position: relative;
}

/* Scrollable Device Matrix */
.device-matrix {
  flex: 1;
  overflow-y: scroll;
  padding: 15px;
  background: #050608;
}

.device-box {
  background: #0d1117;
  border: 1px solid var(--border);
  padding: 15px;
  margin-bottom: 15px;
  position: relative;
  transition: transform 0.2s ease;
  cursor: pointer;
}

.device-box:hover { transform: scale(1.02); }
.device-box:active { transform: scale(0.98); }

.device-box.bluetooth { border-left: 4px solid var(--accent); }
.device-box.wifi { border-left: 4px solid var(--success); }
.device-box.nfc { border-left: 4px solid var(--warning); }
.device-box.ble { border-left: 4px solid var(--danger); }

.box-header { 
    display: flex; 
    justify-content: space-between; 
    margin-bottom: 8px;
    font-size: 8px;
    letter-spacing: 1px;
    color: var(--text);
}

.device-name { color: var(--highlight); font-weight: bold; font-size: 15px; margin-bottom: 5px; }
.signal-strength { font-size: 26px; font-weight: 900; color: var(--accent); }
.unit { font-size: 12px; color: var(--text); font-weight: normal; margin-left: 4px; }
.last-seen { font-size: 10px; color: var(--text); margin-top: 5px; }

/* Control Panel */
.control-panel {
  padding: 15px;
  background: var(--panel);
  border-top: 1px solid var(--border);
  display: flex;
  justify-content: space-around;
  align-items: center;
}

.scan-btn {
  background: var(--accent);
  color: #000;
  border: none;
  padding: 10px 20px;
  font-weight: 900;
  font-size: 14px;
  cursor: pointer;
  letter-spacing: 2px;
  clip-path: polygon(5% 0, 100% 0, 95% 100%, 0 100%);
}

.reset-btn {
  background: var(--danger);
  color: var(--highlight);
  border: none;
  padding: 10px 20px;
  font-weight: 900;
  font-size: 14px;
  cursor: pointer;
  letter-spacing: 2px;
  clip-path: polygon(5% 0, 100% 0, 95% 100%, 0 100%);
}

.scan-progress {
  width: 200px;
  height: 10px;
  background: #1f2937;
  border-radius: 5px;
  overflow: hidden;
  margin-left: 10px;
}

.progress-bar {
  height: 100%;
  background: var(--accent);
  width: 0%;
  transition: width 0.5s;
}

/* Status Indicators */
.status-indicator {
  display: flex;
  align-items: center;
  margin-right: 20px;
  font-size: 12px;
}

.status-light {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  margin-right: 8px;
}

.status-light.active { background: var(--success); }
.status-light.inactive { background: var(--danger); }

/* Device Details Modal */
.device-modal {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.8);
  z-index: 10000;
  display: none;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  text-align: center;
}

.modal-content {
  background: var(--panel);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 20px;
  width: 80%;
  max-width: 400px;
}

.modal-header {
  font-size: 20px;
  margin-bottom: 15px;
  color: var(--highlight);
}

.modal-body {
  font-size: 14px;
  line-height: 1.6;
  margin-bottom: 20px;
}

.modal-footer {
  display: flex;
  justify-content: center;
}

.close-btn {
  background: var(--danger);
  color: var(--highlight);
  border: none;
  padding: 8px 15px;
  font-weight: 900;
  font-size: 12px;
  cursor: pointer;
  clip-path: polygon(5% 0, 100% 0, 95% 100%, 0 100%);
}

/* Scan history */
.scan-history {
  padding: 10px;
  background: rgba(0,0,0,0.5);
  font-size: 10px;
  color: var(--text);
  text-align: center;
}

.scan-history-item {
  margin: 5px 0;
  padding: 5px;
  border-bottom: 1px solid var(--border);
}
</style>
</head>
<body>

<div class="system-status">
    <div class="radar-vitals">DEVICES_SCANNED: <span id="device-count">0</span></div>
    <div class="live-pulse">SCAN_ACTIVE</div>
</div>

<div class="scanner-viewport">
    <div class="scanner-grid"></div>
    <div id="scan-beam"></div>
    <div class="scanner-beacon"></div>
</div>

<div class="control-panel">
    <button class="scan-btn" onclick="startScan()">START SCAN</button>
    <button class="reset-btn" onclick="resetScan()">RESET</button>
    <div class="scan-progress">
        <div class="progress-bar" id="progress-bar"></div>
    </div>
    <div class="status-indicator">
        <div class="status-light active" id="bt-status"></div>
        <div>BLUETOOTH</div>
    </div>
    <div class="status-indicator">
        <div class="status-light inactive" id="wifi-status"></div>
        <div>WIFI</div>
    </div>
    <div class="status-indicator">
        <div class="status-light inactive" id="nfc-status"></div>
        <div>NFC</div>
    </div>
    <div class="status-indicator">
        <div class="status-light inactive" id="ble-status"></div>
        <div>BLE</div>
    </div>
</div>

<div class="scan-history" id="scan-history">
    <div>Recent Scans:</div>
    <div class="scan-history-item" id="history-item-1">No scans yet</div>
</div>

<div class="device-matrix" id="matrix">
    <!-- Scanned devices will appear here -->
</div>

<div class="device-modal" id="device-modal">
    <div class="modal-content">
        <div class="modal-header" id="modal-title">Device Details</div>
        <div class="modal-body" id="modal-details">
            <!-- Device details will be populated here -->
        </div>
        <div class="modal-footer">
            <button class="close-btn" onclick="hideModal()">CLOSE</button>
        </div>
    </div>
</div>

<script>
let scannedDevices = new Map();
const matrix = document.getElementById('matrix');
const btStatus = document.getElementById('bt-status');
const wifiStatus = document.getElementById('wifi-status');
const nfcStatus = document.getElementById('nfc-status');
const bleStatus = document.getElementById('ble-status');
const progressBar = document.getElementById('progress-bar');
const historyItem = document.getElementById('history-item-1');

// Device types mapping
const DEVICE_TYPES = {
    'bluetooth': { name: 'Bluetooth', color: '#00d4ff' },
    'wifi': { name: 'WiFi', color: '#08f7af' },
    'nfc': { name: 'NFC', color: '#f59e0b' },
    'ble': { name: 'BLE', color: '#ff2e63' }
};

// Initialize scanner
async function initializeScanner() {
    try {
        if (!navigator.bluetooth) {
            throw new Error('Web Bluetooth API not supported');
        }
        
        btStatus.classList.add('active');
        updateDeviceCount();
        updateHistory();
    } catch (error) {
        console.error('Bluetooth initialization error:', error);
        btStatus.classList.remove('active');
        btStatus.classList.add('inactive');
    }
}

// Start scanning for devices
async function startScan() {
    try {
        // Clear previous scan
        clearScan();
        
        // Update progress
        updateProgress(20);
        
        // Request Bluetooth permission
        const device = await navigator.bluetooth.requestDevice({
            acceptAllDevices: true,
            optionalServices: ['generic_access']
        });
        
        // Add to list
        addDevice(device);
        
        // Update progress
        updateProgress(40);
        
        // Enable continuous scanning
        enableContinuousScan();
        
        // Update progress
        updateProgress(60);
        
        // Update history
        updateHistory();
        
        // Finalize progress
        setTimeout(() => {
            updateProgress(100);
            setTimeout(() => updateProgress(0), 500);
        }, 1000);
    } catch (error) {
        console.error('Scan error:', error);
        alert('Scan failed: ' + error.message);
        updateProgress(0);
    }
}

// Enable continuous scanning
function enableContinuousScan() {
    // In a real implementation, we would use Web Bluetooth's advertisement data
    // For this demo, we'll just generate mock devices
    setInterval(generateMockDevices, 2000);
}

// Generate mock devices for demonstration
function generateMockDevices() {
    const types = Object.keys(DEVICE_TYPES);
    for (let i = 0; i < 3; i++) {
        const type = types[Math.floor(Math.random() * types.length)];
        const device = {
            id: `mock-${Date.now()}-${i}`,
            name: `Mock ${DEVICE_TYPES[type].name} Device`,
            rssi: -Math.floor(Math.random() * 60),
            type: type,
            lastSeen: Date.now()
        };
        
        // Add to list if not already present
        if (!scannedDevices.has(device.id)) {
            addDevice(device);
        }
    }
}

// Add device to list
function addDevice(device) {
    if (!device.id || scannedDevices.has(device.id)) {
        return;
    }
    
    // Add to map
    scannedDevices.set(device.id, device);
    
    // Render device
    renderDevice(device);
    
    // Update count
    updateDeviceCount();
}

// Render device in matrix
function renderDevice(device) {
    let existing = document.getElementById(`device-${device.id}`);
    
    if (existing) {
        // Update signal strength
        const strengthElement = existing.querySelector('.signal-strength');
        strengthElement.textContent = `${Math.abs(device.rssi)}dBm`;
        
        // Update last seen
        const lastSeenElement = existing.querySelector('.last-seen');
        lastSeenElement.textContent = formatDate(device.lastSeen);
    } else {
        // Create new element
        const box = document.createElement('div');
        box.id = `device-${device.id}`;
        box.className = `device-box ${device.type}`;
        box.innerHTML = `
            <div class="box-header">
                <span>DEVICE_ID: ${device.id.substring(0, 8)}</span>
                <span style="color:${DEVICE_TYPES[device.type].color}">TYPE: ${DEVICE_TYPES[device.type].name}</span>
            </div>
            <div class="device-name">${device.name || 'Unnamed Device'}</div>
            <div class="signal-strength">${Math.abs(device.rssi)}<span class="unit">dBm</span></div>
            <div class="last-seen">Last seen: ${formatDate(device.lastSeen)}</div>
        `;
        
        // Add click handler
        box.addEventListener('click', () => showDeviceDetails(device));
        
        // Add to matrix
        matrix.prepend(box);
    }
}

// Format timestamp for display
function formatDate(timestamp) {
    const date = new Date(timestamp);
    return date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
}

// Show device details
function showDeviceDetails(device) {
    const modal = document.getElementById('device-modal');
    const title = document.getElementById('modal-title');
    const details = document.getElementById('modal-details');
    
    title.textContent = device.name || 'Device Details';
    
    details.innerHTML = `
        <p><strong>ID:</strong> ${device.id}</p>
        <p><strong>Type:</strong> ${DEVICE_TYPES[device.type].name}</p>
        <p><strong>Signal Strength:</strong> ${Math.abs(device.rssi)}dBm</p>
        <p><strong>Last Seen:</strong> ${formatDate(device.lastSeen)}</p>
        <p><strong>First Detected:</strong> ${formatDate(device.firstDetected || device.lastSeen)}</p>
        <p><strong>Connection Status:</strong> ${device.connected ? 'Connected' : 'Disconnected'}</p>
    `;
    
    modal.style.display = 'flex';
}

// Hide modal
function hideModal() {
    document.getElementById('device-modal').style.display = 'none';
}

// Clear current scan
function clearScan() {
    scannedDevices.clear();
    matrix.innerHTML = '';
    updateDeviceCount();
}

// Reset scan
function resetScan() {
    clearScan();
    updateDeviceCount();
    updateHistory();
}

// Update device count
function updateDeviceCount() {
    document.getElementById('device-count').textContent = scannedDevices.size;
}

// Update progress bar
function updateProgress(percent) {
    progressBar.style.width = percent + '%';
}

// Update scan history
function updateHistory() {
    const now = new Date();
    historyItem.textContent = `Scan completed: ${now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
}

// Initialize when page loads
window.onload = initializeScanner;
</script>

</body>
</html>